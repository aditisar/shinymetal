<h3>User Key</h3>

<p>
  <strong>Approval Status:</strong>
  <i class="fi-check success">
    Begun by requester?
  </i> &nbsp;
  <i class="fi-arrow-right"></i> &nbsp;
  <i class="<%= @user_key.at_stage?(:awaiting_filters, true) ? "fi-check success" : "fi-x alert" %>">
    Submitted?
  </i> &nbsp;
  <i class="fi-arrow-right"></i> &nbsp;
  <i class="<%= @user_key.at_stage?(:awaiting_confirmation, true) ? "fi-check success" : "fi-x alert" %>">
    Assigned Filters?
  </i> &nbsp;
  <i class="fi-arrow-right"></i> &nbsp;
  <i class="<%= @user_key.at_stage?(:confirmed) ? "fi-check success" : "fi-x alert" %>">
    Confirmed?
  </i>
</p>

<p>
  <% if @user_key.at_stage?(:confirmed) %>
    <i class="fi-check success"></i>&nbsp;This approval is complete.</i>
  <% else %>
    <i class="fi-x alert"></i>&nbsp;<i>This approval is incomplete.</i>
  <% end %>
</p>

<p>
  <strong>User:</strong>
  <%= link_to @user_key.user.andrew_id, @user_key.user  %>
</p>

<p>
  <strong>Time submitted:</strong>
  <%= @user_key.time_submitted.nil? ? "Not submitted yet" : @user_key.time_submitted.to_formatted_s(:pretty) %>
</p>

<p> 
  <strong>Time shared with approvers:</strong>
  <%= @user_key.time_filtered.nil? ? "Not shared with approvers yet" : @user_key.time_filtered.to_formatted_s(:pretty) %>
</p>

<p>
  <strong>Time confirmed:</strong>
  <%= @user_key.time_confirmed.nil? ? "Not confirmed yet" : @user_key.time_confirmed.to_formatted_s(:pretty) %>
</p>

<p>
  <strong>Value:</strong>
  <%= @user_key.value %>
</p>

<p>
  <strong>Application text:</strong>
  <%= @user_key.application_text %>
</p>

<p>
  <strong>Active:</strong>
  <%= @user_key.active %>
</p>

<% unless @user_key.active %>
  <p>
    <strong>Reason for inactivation:</strong>
    <% if user_key.reason.blank? %>
      <%= @user_key.reason %>
    <% else %>
    <p><i>No reason was given.</i></p>  
    <% end %>
  </p>
<% end %>

<% if @current_user.is_approver %>  
    <%= render partial: 'user_keys/show_partials/list_of_filters' %>

    <%= render partial: 'user_keys/show_partials/list_of_organizations' %>

    <%= render partial: 'user_keys/show_partials/approval_checkbox' %>

    <%= render partial: 'user_keys/show_partials/submit_buttons' %>
    
<% end %>  

<%= link_to 'Edit', edit_user_key_path(@user_key), class: "big-button" %> |
<%= link_to 'Back', user_keys_path, class: "big-button secondary" %> |
<%= link_to 'Destroy', @user_key, method: :delete, data: { confirm: 'Are you sure?' }, class: "small-button" %>

<%= render partial: 'user_keys/show_partials/list_of_approvers' %>

<div id="comments">
<%= render partial: 'user_keys/show_partials/list_of_comments' %>
</div>