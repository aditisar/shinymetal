<!--Show existing comments -->
<h3>Comments</h3>

<br/>

<% for comment in @comments %>
  <fieldset>
    <strong><%= comment.comment_user.andrew_id %></strong>
    &nbsp;<%= comment.created_at.to_formatted_s(:pretty) %>
    &nbsp;<%= "(private)" if comment.is_private %>
    <%= link_to "X", delete_comment_path(id: @user_key.id, comment_id: comment.id),
	method: :patch, data: { confirm: 'Are you sure you want to delete this comment?'}, class: "small-button right" %>
    <br />
    <p><%= comment.message %></p>
  </fieldset>
<% end %>

<%= form_for(@user_key, url: add_comment_path(@user_key)) do |f| %>
  <fieldset>
  	  
  <legend>Add a comment</legend>

  <!--Allow new comment to be added-->
  <%= f.fields_for :comments, @comment do |p| %>
  
    <%= render 'shared/error_messages', object: @user_key %>
  
        <%= p.hidden_field :user_id, value: @current_user.id %>
	<div class="row">
	    <%= p.label :message %>
	    <%= p.text_field :message %>
	</div>
  <% end %>
  
  <div class="actions">
    <%= f.submit class: "big-button success", value: "Add comment" %>
  </div>
  
  </fieldset>
  
<% end %>
